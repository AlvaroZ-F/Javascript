<!DOCTYPE html>
<html lang="eng">
	<head>
		<title>Space Invaderz</title>
		<link rel="stylesheet" href="style.css">
	</head>

	<body>
		
		<div id="game">
			<div id="gun"></div>
			<div id="invaders"></div>
			<div id="missiles"></div>
		</div>

		<script>

			var gun = {
				top: 700,
				left: 550
			};

			var invaders = [
				{ left: 200, top: 100 },
				{ left: 300, top: 100 },
				{ left: 400, top: 100 },
				{ left: 500, top: 100 },
				{ left: 600, top: 100 },
				{ left: 700, top: 100 },
				{ left: 800, top: 100 },
				{ left: 900, top: 100 },
				{ left: 200, top: 175 },
				{ left: 300, top: 175 },
				{ left: 400, top: 175 },
				{ left: 500, top: 175 },
				{ left: 600, top: 175 },
				{ left: 700, top: 175 },
				{ left: 800, top: 175 },
				{ left: 900, top: 175 }
			];

			var missiles = [];

			var score = 0;

			var lose = false;

			document.onkeydown = function (e) {
				console.log(e);
				if (e.keyCode === 37) {
					console.log("LEFT");
					gun.left -= 10;
					drawGun();
				} else if (e.keyCode === 39) {
					console.log("RIGHT");
					gun.left = gun.left+10;
					drawGun();
				}

				if (e.keyCode == 32) {
					console.log("FIRE");
					missiles.push({
						left: gun.left + 15,
						top: gun.top + 5
					});
					drawMissiles();
				}
			}

			function drawGun() {
				document.getElementById("gun").style.left = gun.left + "px";
			}

			function drawMissiles() {
				document.getElementById("missiles").innerHTML= "";
				for (var missile = 0; missile < missiles.length; missile++) {
					document.getElementById("missiles").innerHTML += `<div class='missile' style='left:${missiles[missile].left}px; top:${missiles[missile].top}px;'></div>`;					
				}
			}

			function drawInvaders() {
				document.getElementById("invaders").innerHTML= "";
				for (var invader = 0; invader < invaders.length; invader++) {
					document.getElementById("invaders").innerHTML += `<div class='invader' style='left:${invaders[invader].left}px; top:${invaders[invader].top}px;'></div>`;					
				}
			}

			function moveMissiles() {
				for (var missile = 0; missile < missiles.length; missile ++) {
					missiles[missile].top = missiles[missile].top - 5;
				}
			}

			function moveInvaders() {
				var invaderSpeed = 1;
				for (var invader = 0; invader < invaders.length; invader ++) {
					invaders[invader].top = invaders[invader].top + invaderSpeed;
				}
			}

			function collisionDetection () {
				for (var invader = 0; invader < invaders.length; invader++) {
					for (var missile = 0; missile < missiles.length; missile++) {
						if (
							(missiles[missile].top <= invaders[invader].top + 50)
							&&
							(missiles[missile].top > invaders[invader].top)
							&&
							(missiles[missile].left >= invaders[invader].left)
							&&
							(missiles[missile].left <= invaders[invader].left + 50)
							){
						invaders.splice(invader, 1);
						missiles.splice(missile, 1);
						score += 10;
						}
					}
					if ( invaders[invader].top > 750 ) {
						invaders.splice(invader, 1);
						score -= 100;
					} 
				}
			}

			function gameLoop () {
				setTimeout(gameLoop, 100);
				moveMissiles();
				drawMissiles();
				moveInvaders();
				drawInvaders();
				collisionDetection();
			}
			gameLoop();

		</script>

	</body>
</html>